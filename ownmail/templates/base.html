<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ownmail{% endblock %}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="ownmail-loading-overlay" id="ownmail-loading-overlay">
        <div class="ownmail-loading-spinner"></div>
    </div>
    <div class="ownmail-header">
        <h1><a href="/">ðŸ“­ ownmail</a></h1>
        <span class="ownmail-stats">{{ stats.total_emails | default(0) | int }} emails archived &bull; <a href="/help">Search help</a></span>
    </div>
    {% block content %}{% endblock %}
    <script>
    function showLoading(event) {
        // Don't show loading overlay for cmd+click or ctrl+click (new tab)
        if (event && (event.metaKey || event.ctrlKey)) {
            return;
        }
        document.getElementById('ownmail-loading-overlay').classList.add('ownmail-active');
    }
    function hideLoading() {
        document.getElementById('ownmail-loading-overlay').classList.remove('ownmail-active');
    }
    // Hide loading overlay when page is shown (handles back/forward navigation)
    // This fires when page is restored from bfcache (back-forward cache)
    window.addEventListener('pageshow', function(event) {
        hideLoading();
    });
    // Also hide on regular page load just in case
    window.addEventListener('load', function() {
        hideLoading();
    });
    // Show loading on form submit
    document.querySelectorAll('form').forEach(function(form) {
        form.addEventListener('submit', function(e) {
            showLoading(e);
        });
    });
    // Show loading on email item click
    document.querySelectorAll('.ownmail-email-item a').forEach(function(link) {
        link.addEventListener('click', function(e) {
            showLoading(e);
        });
    });
    // Show loading on pagination click
    document.querySelectorAll('.ownmail-pagination a').forEach(function(link) {
        link.addEventListener('click', function(e) {
            showLoading(e);
        });
    });
    </script>
</body>
</html>
